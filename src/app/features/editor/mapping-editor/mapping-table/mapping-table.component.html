<!--
SPDX-FileCopyrightText: 2022 Argho Tuning Project Authors

SPDX-License-Identifier: Apache-2.0
-->

<div class="mapping-table-wrapper">

<table #mappingTable mat-table [dataSource]="dataSource" class="mapping-table mat-elevation-z2"
       (click)="handleTableClick($event)">
  <ng-container [matColumnDef]="MappingTableCol.NUM">
    <th mat-header-cell *matHeaderCellDef>#</th>
    <td mat-cell *matCellDef="let element" [class.black-key]="element.blackKey">
      <span class="mapping-num">{{element.key.displayNumber}}</span>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="MappingTableCol.KEY">
    <th mat-header-cell *matHeaderCellDef><span class="mapping-key">Key</span></th>
    <td mat-cell *matCellDef="let element" [class.black-key]="element.blackKey">
      <app-spelled-pitch *ngIf="element.pitch" [pitch]="element.pitch"></app-spelled-pitch>
      <ng-container *ngIf="!element.pitch">-</ng-container>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="MappingTableCol.DEG">
    <th mat-header-cell *matHeaderCellDef><span class="mapping-deg">Scale Deg.</span></th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'editable': element.editable}">
      <span class="mapping-deg">
        <span class="play-button-wrapper">
          <button *ngIf="element.mappedDeg" mat-button class="play-button" aria-label="Play"
                  (mousedown)="playDegree(element.mappedDeg.index)"
                  (mouseup)="stopDegree(element.mappedDeg.index)">
            <fa-icon [icon]="faPlayCircle"></fa-icon>
          </button>
        </span>
        {{element.mappedDeg?.displayNumber || '-'}}
      </span>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columns"></tr>
  <tr mat-row *matRowDef="let row; columns: columns;" [attr.data-key-idx]="row.key.index"></tr>
</table>

<mat-card #popupEditor class="mapping-field-editor mat-elevation-z6"
          [style.display]="showPopupEditor ? 'block' : 'none'">
  <mat-form-field #popupField appearance="standard">
    <mat-label>Scale Deg.</mat-label>
    <input #popupInput type="text" matInput (blur)="handlePopupInputBlur()">
  </mat-form-field>
</mat-card>

</div>
